<div class="max-w-2xl mx-auto mt-8 p-6 bg-white rounded-lg shadow-lg">
  <div class="text-center mb-6">
    <%= image_tag gravatar_url(@provider.user.email), 
        class: "mx-auto mb-4 rounded-full w-32 h-32 object-cover shadow-lg" %>
    <h1 class="text-3xl font-bold text-gray-900"><%= @provider.name %></h1>
    <p class="text-lg text-gray-600"><%= @provider.service_type %></p>
  </div>
  <div class="grid grid-cols-2 gap-4 mb-6">
    <div class="text-gray-600">
      <p class="font-semibold">Location:</p>
      <p><%= @provider.location %></p>
    </div>
    <div class="text-gray-600">
      <p class="font-semibold">Experience:</p>
      <p><%= @provider.experience %> years</p>
    </div>
    <div class="text-gray-600">
      <p class="font-semibold">Hourly Rate:</p>
      <p><%= @provider.hourly_rate %> RON</p>
    </div>
    <div class="text-gray-600">
      <p class="font-semibold">Rating:</p>
      <p><%= @provider.rating ? "#{@provider.rating}/5" : "No ratings yet" %></p>
    </div>
  </div>
  <div class="mb-6">
    <h2 class="text-xl font-semibold text-gray-900 mb-2">About</h2>
    <p class="text-gray-600"><%= @provider.bio %></p>
  </div>
  <% if current_user == @provider.user %>
    <div class="space-y-4">
      <% if @provider.calendly_url.nil? %>
        <div class="text-red-600">Your account is not active. Please create and add your calendly profile</div>
      <% end %>
      
      <% if @provider.stripe_account_id.nil? %>
        <div class="text-red-600">
          To receive payments, you need to set up your Stripe account
          <%= button_to "Set up Stripe Account", 
              stripe_connect_index_path(provider_id: @provider.id),
              method: :post, 
              class: "mt-2 mb-2 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",
              data: { turbo: false }%>
        </div>
      <% end %>
    </div>
  <% end %>
  
  <div class="flex justify-between items-center">
    <% if current_user == @provider.user %>
      <%= link_to "Edit Profile", edit_provider_path(@provider), 
          class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" %>
    <%else%>
      <% if @provider.calendly_url.present?%>
        <%= link_to "Book an Appointment", @provider.calendly_url, 
        class: "bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded", target: "_blank" %>
        <%= button_to "Pay", appointments_path(appointment_time: Time.now, provider_id: @provider.id),
        method: :post, class: "bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded",data: { turbo: false } %>
      <%else%>
        <p class= "text-gray-600">This provider has not set up a booking link yet. </p>
      <%end%>
    <% end %>
  </div>
  <% if current_user != @provider.user %>
    <div 
      data-controller="calendly"
      data-calendly-url="<%= @provider.calendly_url %>"
      data-user-name="<%= current_user.name %>"
      data-user-email="<%= current_user.email %>"
      data-provider-id="<%= @provider.id %>"
      style="min-height: 700px;">
    </div>
  <% end %>
</div>
