<% if user_signed_in? %>
  <% if current_user.user? %>
    <h2 class="text-2xl font-bold mb-4">Browse Providers</h2>
    <div class="flex mb-4">
      <div class="flex-grow">
        <%= form_with url: providers_path, method: :get, local: true do %>
          <div class="mb-4">
            <%= select_tag :category, options_for_select(@categories.keys, selected: params[:category]), 
              prompt: "Filter by Category", class: "form-select" %>
            <%= hidden_field_tag :service_type, params[:service_type] %>
            <%= hidden_field_tag :location, params[:location] %>
            <%= submit_tag "Filter", class: "btn btn-primary ml-2" %>
          </div>
        <% end %>
        <% if params[:category].present? %>
          <%= form_with url: providers_path, method: :get, local: true do %>
            <div class="mb-4">
              <%= select_tag :service_type, 
                options_for_select(@categories[params[:category]], selected: params[:service_type]), 
                prompt: "Filter by Service Type", class: "form-select" %>
              <%= hidden_field_tag :category, params[:category] %>
              <%= hidden_field_tag :location, params[:location] %>
              <%= submit_tag "Filter", class: "btn btn-secondary ml-2" %>
            </div>
          <% end %>
        <% end %>
        <%= form_with url: providers_path, method: :get, local: true do %>
          <div class="mb-4">
            <%= select_tag :location, 
              options_for_select(["Bucharest", "Cluj-Napoca", "Timisoara", "Iasi"], selected: params[:location]), 
              prompt: "Filter by Location", class: "form-select" %>
            <%= hidden_field_tag :category, params[:category] %>
            <%= hidden_field_tag :service_type, params[:service_type] %>
            <%= submit_tag "Filter", class: "btn btn-info ml-2" %>
          </div>
        <% end %>
      </div>
      <!-- Selected Filters Display -->
      <div class="ml-4 flex flex-col">
        <h3 class="font-semibold">Selected Filters:</h3>
        <div class="flex flex-wrap">
          <% if params[:category].present? %>
            <div class="bg-blue-200 text-blue-800 px-2 py-1 rounded-full flex items-center mr-2 mb-2">
              <span><%= params[:category] %></span>
              <%= link_to '✖', providers_path(service_type: params[:service_type], location: params[:location]), method: :delete, class: "ml-2 text-blue-600 hover:text-blue-800" %>
            </div>
          <% end %>
          <% if params[:service_type].present? %>
            <div class="bg-green-200 text-green-800 px-2 py-1 rounded-full flex items-center mr-2 mb-2">
              <span><%= params[:service_type] %></span>
              <%= link_to '✖', providers_path(category: params[:category], location: params[:location]), method: :delete, class: "ml-2 text-green-600 hover:text-green-800" %>
            </div>
          <% end %>
          <% if params[:location].present? %>
            <div class="bg-yellow-200 text-yellow-800 px-2 py-1 rounded-full flex items-center mr-2 mb-2">
              <span><%= params[:location] %></span>
              <%= link_to '✖', providers_path(category: params[:category], service_type: params[:service_type]), method: :delete, class: "ml-2 text-yellow-600 hover:text-yellow-800" %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
    <div id="providers-container">
      <%= turbo_frame_tag "providers" do %>
        <%= render partial: "providers_list", locals: { providers: @providers } %>
      <% end %>
    </div>
  <% end %>
<% else %>
  <div class="text-center py-12">
    <h1 class="text-3xl font-bold mb-4">Welcome to NearYou</h1>
    <p class="text-lg mb-8">Find and book local service providers</p>
    <div class="space-x-4">
      <%= link_to "Sign In", new_user_session_path, 
          class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" %>
      <%= link_to "Sign Up", new_user_registration_path, 
          class: "bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded" %>
    </div>
  </div>
<% end %>